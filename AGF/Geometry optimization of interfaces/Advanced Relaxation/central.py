# -*- coding: utf-8 -*-
# -------------------------------------------------------------
# Bulk Configuration
# -------------------------------------------------------------

# Set up lattice
vector_a = [20.2231832312, 0.0, 0.0]*Angstrom
vector_b = [0.0, -2.88902617589, 0.0]*Angstrom
vector_c = [0.0, 0.0, 37.0677893739]*Angstrom
lattice = UnitCell(vector_a, vector_b, vector_c)

# Define elements
elements = [Silver, Silver, Silver, Silver, Silver, Silver, Silver, Silver,
            Silver, Silver, Silver, Silver, Silver, Silver, Silver, Silver,
            Silver, Silver, Silver, Silver, Silver, Silver, Silver, Silver,
            Silver, Silver, Silver, Silver, Silver, Silver, Silver, Silver,
            Silver, Silver, Silver, Silver, Silver, Silver, Silver, Silver,
            Silver, Silver, Silver, Silver, Silver, Silver, Silver, Silver,
            Silver, Gold, Gold, Gold, Gold, Gold, Gold, Gold, Gold, Gold, Gold,
            Gold, Gold, Gold, Gold, Gold, Gold, Gold, Gold, Gold, Gold, Gold,
            Gold, Gold, Gold, Gold, Gold, Gold, Gold, Gold, Gold, Gold, Gold,
            Gold, Gold, Gold, Gold, Gold, Gold, Gold, Gold, Gold, Gold, Gold,
            Gold, Gold, Gold, Gold, Gold]

# Define coordinates
fractional_coordinates = [[ 0.            ,  0.            ,  0.14492353225 ],
                          [ 0.142857142857,  0.            ,  0.14492353225 ],
                          [ 0.285714285715,  0.            ,  0.14492353225 ],
                          [ 0.428571428572,  0.            ,  0.14492353225 ],
                          [ 0.571428571429,  0.            ,  0.14492353225 ],
                          [ 0.714285714287,  0.            ,  0.14492353225 ],
                          [ 0.857142857144,  0.            ,  0.14492353225 ],
                          [ 0.071428571429,  0.5           ,  0.200034722707],
                          [ 0.214285714286,  0.5           ,  0.200034722707],
                          [ 0.357142857143,  0.5           ,  0.200034722707],
                          [ 0.500000000001,  0.5           ,  0.200034722707],
                          [ 0.642857142858,  0.5           ,  0.200034722707],
                          [ 0.785714285715,  0.5           ,  0.200034722707],
                          [ 0.928571428573,  0.5           ,  0.200034722707],
                          [ 0.            ,  0.            ,  0.255145913164],
                          [ 0.142857142857,  0.            ,  0.255145913164],
                          [ 0.285714285715,  0.            ,  0.255145913164],
                          [ 0.428571428572,  0.            ,  0.255145913164],
                          [ 0.571428571429,  0.            ,  0.255145913164],
                          [ 0.714285714287,  0.            ,  0.255145913164],
                          [ 0.857142857144,  0.            ,  0.255145913164],
                          [ 0.071428571429,  0.5           ,  0.310257103621],
                          [ 0.214285714286,  0.5           ,  0.310257103621],
                          [ 0.357142857143,  0.5           ,  0.310257103621],
                          [ 0.500000000001,  0.5           ,  0.310257103621],
                          [ 0.642857142858,  0.5           ,  0.310257103621],
                          [ 0.785714285715,  0.5           ,  0.310257103621],
                          [ 0.928571428573,  0.5           ,  0.310257103621],
                          [ 0.            ,  0.            ,  0.365368294078],
                          [ 0.142857142857,  0.            ,  0.365368294078],
                          [ 0.285714285715,  0.            ,  0.365368294078],
                          [ 0.428571428572,  0.            ,  0.365368294078],
                          [ 0.571428571429,  0.            ,  0.365368294078],
                          [ 0.714285714287,  0.            ,  0.365368294078],
                          [ 0.857142857144,  0.            ,  0.365368294078],
                          [ 0.071428571429,  0.5           ,  0.420479484535],
                          [ 0.214285714286,  0.5           ,  0.420479484535],
                          [ 0.357142857143,  0.5           ,  0.420479484535],
                          [ 0.500000000001,  0.5           ,  0.420479484535],
                          [ 0.642857142858,  0.5           ,  0.420479484535],
                          [ 0.785714285715,  0.5           ,  0.420479484535],
                          [ 0.928571428573,  0.5           ,  0.420479484535],
                          [ 0.            ,  0.            ,  0.475590674991],
                          [ 0.142857142857,  0.            ,  0.475590674991],
                          [ 0.285714285715,  0.            ,  0.475590674991],
                          [ 0.428571428572,  0.            ,  0.475590674991],
                          [ 0.571428571429,  0.            ,  0.475590674991],
                          [ 0.714285714287,  0.            ,  0.475590674991],
                          [ 0.857142857144,  0.            ,  0.475590674991],
                          [ 0.166704890125,  0.            ,  0.539854082725],
                          [ 0.416704890125,  0.            ,  0.539854082725],
                          [ 0.666704890126,  0.            ,  0.539854082725],
                          [ 0.916704890126,  0.            ,  0.539854082725],
                          [ 0.041704890125,  0.5           ,  0.539854082725],
                          [ 0.291704890125,  0.5           ,  0.539854082725],
                          [ 0.541704890126,  0.5           ,  0.539854082725],
                          [ 0.791704890126,  0.5           ,  0.539854082725],
                          [ 0.083371556792, -0.            ,  0.60289855973 ],
                          [ 0.333371556792, -0.            ,  0.60289855973 ],
                          [ 0.583371556792, -0.            ,  0.60289855973 ],
                          [ 0.833371556793, -0.            ,  0.60289855973 ],
                          [ 0.208371556792,  0.5           ,  0.60289855973 ],
                          [ 0.458371556792,  0.5           ,  0.60289855973 ],
                          [ 0.708371556793,  0.5           ,  0.60289855973 ],
                          [ 0.958371556793,  0.5           ,  0.60289855973 ],
                          [ 0.000038223458,  0.            ,  0.665943036735],
                          [ 0.250038223459,  0.            ,  0.665943036735],
                          [ 0.500038223459,  0.            ,  0.665943036735],
                          [ 0.750038223459,  0.            ,  0.665943036735],
                          [ 0.125038223458,  0.5           ,  0.665943036735],
                          [ 0.375038223459,  0.5           ,  0.665943036735],
                          [ 0.625038223459,  0.5           ,  0.665943036735],
                          [ 0.87503822346 ,  0.5           ,  0.665943036735],
                          [ 0.166704890125,  0.            ,  0.72898751374 ],
                          [ 0.416704890125,  0.            ,  0.72898751374 ],
                          [ 0.666704890126,  0.            ,  0.72898751374 ],
                          [ 0.916704890126,  0.            ,  0.72898751374 ],
                          [ 0.041704890125,  0.5           ,  0.72898751374 ],
                          [ 0.291704890125,  0.5           ,  0.72898751374 ],
                          [ 0.541704890126,  0.5           ,  0.72898751374 ],
                          [ 0.791704890126,  0.5           ,  0.72898751374 ],
                          [ 0.083371556792, -0.            ,  0.792031990745],
                          [ 0.333371556792, -0.            ,  0.792031990745],
                          [ 0.583371556792, -0.            ,  0.792031990745],
                          [ 0.833371556793, -0.            ,  0.792031990745],
                          [ 0.208371556792,  0.5           ,  0.792031990745],
                          [ 0.458371556792,  0.5           ,  0.792031990745],
                          [ 0.708371556793,  0.5           ,  0.792031990745],
                          [ 0.958371556793,  0.5           ,  0.792031990745],
                          [ 0.000038223458,  0.            ,  0.85507646775 ],
                          [ 0.250038223459,  0.            ,  0.85507646775 ],
                          [ 0.500038223459,  0.            ,  0.85507646775 ],
                          [ 0.750038223459,  0.            ,  0.85507646775 ],
                          [ 0.125038223458,  0.5           ,  0.85507646775 ],
                          [ 0.375038223459,  0.5           ,  0.85507646775 ],
                          [ 0.625038223459,  0.5           ,  0.85507646775 ],
                          [ 0.87503822346 ,  0.5           ,  0.85507646775 ]]

# Set up configuration
bulk_configuration = BulkConfiguration(
    bravais_lattice=lattice,
    elements=elements,
    fractional_coordinates=fractional_coordinates
    )

# Add tags
bulk_configuration.addTags('Left Interface',  [ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12,
                                               13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,
                                               26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38,
                                               39, 40, 41, 42, 43, 44, 45, 46, 47, 48])
bulk_configuration.addTags('Right Interface', [49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61,
                                               62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74,
                                               75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87,
                                               88, 89, 90, 91, 92, 93, 94, 95, 96])
bulk_configuration.addTags('left',            [ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12,
                                               13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,
                                               26, 27, 28, 29, 30, 31, 32, 33, 34])
bulk_configuration.addTags('right',           [81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93,
                                               94, 95, 96])

# -------------------------------------------------------------
# Calculator
# -------------------------------------------------------------

potentialSet = EAM_Zhou_2004()
calculator = TremoloXCalculator(parameters=potentialSet)
calculator.setVerletListsDelta(0.25*Angstrom)

bulk_configuration.setCalculator(calculator)
nlprint(bulk_configuration)
bulk_configuration.update()
nlsave('central.nc', bulk_configuration)

# -------------------------------------------------------------
# Optimize Geometry
# -------------------------------------------------------------
rigid_indices_0 = [81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93,
                   94, 95, 96]
rigid_indices_1 = [ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12,
                   13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,
                   26, 27, 28, 29, 30, 31, 32, 33, 34]
constraints = [RigidBody(rigid_indices_0),
               RigidBody(rigid_indices_1)]

bulk_configuration = OptimizeGeometry(
    bulk_configuration,
    max_forces=0.01*eV/Ang,
    max_steps=200,
    max_step_length=0.2*Ang,
    constraints=constraints,
    trajectory_filename=None,
    disable_stress=True,
    optimizer_method=LBFGS(),
)
nlsave('central.nc', bulk_configuration)
nlprint(bulk_configuration)
